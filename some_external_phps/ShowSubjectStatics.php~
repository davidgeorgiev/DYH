<?php
	include "PrintPercentageBar.php";
	function ReturnAverageStaticsForUserSubject($UserID, $subjectID){
		
		$SQL = "SELECT subjects.Rank FROM subjects WHERE subjects.UID = ".$subjectID;
		$result = mysql_query($SQL);
		$row = mysql_fetch_array($result);
		
		//echo $row[0].$row[1];
		
		$rank_of_subject = $row[0];
		include "subject_scale_to_words.php";
		$rank_of_subject_with_words;
		
		$SQL = "SELECT solvedhomeworks.TimeForSolve,solvedhomeworks.Assessment,
		solvedhomeworks.PleasureInPercents, solvedhomeworks.LengthInPages,
		solvedhomeworks.LearnedInPercents, solvedhomeworks.IfCheating FROM solvedhomeworks WHERE
		solvedhomeworks.USERID = ".$UserID." AND SubjectID = ".$subjectID;
		$MySubjectsStaticsResult = mysql_query($SQL);
		$counter = 0;
		$AssessmentCounter = 0;
		$SumOfTimeForSolve = 0;
		$SumOfAssessment = 0;
		$SumOfPleasureInPercents = 0;
		$SumOfLengthInPages = 0;
		$SumOfLearnedInPercents = 0;
		$SumOfIfCheating = 0;
		while($MySubjectsStatics = mysql_fetch_array($MySubjectsStaticsResult)){
			$counter++;
			$SumOfTimeForSolve += $MySubjectsStatics[0];
			
			if ($MySubjectsStatics[1] > 1){
				$AssessmentCounter++;
				$SumOfAssessment += $MySubjectsStatics[1];
			}
			$SumOfPleasureInPercents += $MySubjectsStatics[2];
			$SumOfLengthInPages += $MySubjectsStatics[3];
			$SumOfLearnedInPercents += $MySubjectsStatics[4];
			$SumOfIfCheating += $MySubjectsStatics[5];
		}
		$ArrayOfSums = array($SumOfTimeForSolve,$SumOfAssessment,$SumOfPleasureInPercents,$SumOfLengthInPages,
		$SumOfLearnedInPercents,$SumOfIfCheating);
		$ArrayOfAverage = array($SumOfTimeForSolve/$counter,$SumOfAssessment/$AssessmentCounter,$SumOfPleasureInPercents/$counter,$SumOfLengthInPages/$counter,
		$SumOfLearnedInPercents/$counter,$SumOfIfCheating/$counter);
		
		$ArrayForReturn = array();
		$ArrayForReturn["NumOfSolvings"] = $counter;
		$ArrayForReturn["NumOfAssessments"] = $AssessmentCounter;
		$ArrayForReturn["Sums"] = $ArrayOfSums;
		$ArrayForReturn["Average"] = $ArrayOfAverage;
		$ArrayForReturn["RankOfSubject"] = $rank_of_subject;
		$ArrayForReturn["RankOfSubjectWithWords"] = $rank_of_subject_with_words;
		
		return $ArrayForReturn;
	}

	function ShowSubjectStatics($UserID, $subjectID){
		$MyUserInfo = GetAccountInfoByUSERNAMEorID($username = "",$UserID);
		$MyUserAverageSubjectStatics = ReturnAverageStaticsForUserSubject($UserID, $subjectID);
		$SQL = "SELECT subjects.NAME FROM subjects WHERE subjects.UID = ".$subjectID;
		$MySubjectName = mysql_query($SQL);
		$MySubjectName = mysql_fetch_array($MySubjectName);
		
		echo '<div id = "MySubjectStaticsBox">';
		echo '<h2>'.$MySubjectName[0];
			echo '<p style = "font-weight:bold;font-size:15px;">'.$MyUserAverageSubjectStatics["RankOfSubjectWithWords"].'</p></h2>
		<button type="button" class="btn btn-default" data-toggle="collapse" data-target="#demo'.$subjectID.'" style = "width:100%;">Подробна статистика</button>
		<div id="'.$subjectID.'" class="collapse">';
			echo '<div class = "SubjectStatics">';
			echo '<p style = "margin-top:-5px;padding-top:20px;">Решени задачи - '.$MyUserAverageSubjectStatics["NumOfSolvings"].', от които оценени са 
			
			'.$MyUserAverageSubjectStatics["NumOfAssessments"].'
			
			</p>';
			echo '<p>БАЛ - '.$MyUserAverageSubjectStatics["Sums"][1].'</p>';
			
			echo '<h3>Статистика на '.$MyUserInfo[2]." ".$MyUserInfo[3].'</h3>';
			PrintPercentagebarSimple(($MyUserAverageSubjectStatics["RankOfSubject"]*10), "Любимост", number_format(($MyUserAverageSubjectStatics["RankOfSubject"]*10),0).'%');
			
			if ($MyUserAverageSubjectStatics["Average"][1] < 2){
				$MyUserAverageSubjectStatics["Average"][1] = "няма";
			}
			$MyTitle = 'Средна оценка досега - '.$MyUserAverageSubjectStatics["Average"][1];
			
			PrintPercentagebarSimple(((($MyUserAverageSubjectStatics["Average"][1]-2)*100)/4), $MyTitle, number_format($MyUserAverageSubjectStatics["Average"][1], 2));
			
			if ($MyUserAverageSubjectStatics["Sums"][0] == 1){
				$MyTimeVal = 'час';
			} else {
				$MyTimeVal = 'часа';
			}
			if ($MyUserAverageSubjectStatics["Sums"][0] < 1){
				$MyUserAverageSubjectStatics["Sums"][0] = 0;
			}
			$MyTitle = 'Отделено време - '.$MyUserAverageSubjectStatics["Sums"][0].' '.$MyTimeVal;
			if ($MyUserAverageSubjectStatics["Average"][0] == 1){
				$MyTimeVal = 'час';
			} else {
				$MyTimeVal = 'часа';
			}
			if ($MyUserAverageSubjectStatics["Average"][0] < 1){
				$MyUserAverageSubjectStatics["Average"][0] = 0;
			}
			$MyTitle .= ', средно по '.$MyUserAverageSubjectStatics["Average"][0].' '.$MyTimeVal .' на задача';
			
			PrintPercentagebarSimple((($MyUserAverageSubjectStatics["Sums"][0]*100)/3.75), $MyTitle, number_format((($MyUserAverageSubjectStatics["Sums"][0]*100)/3.75), 0).'%');
			
			if ($MyUserAverageSubjectStatics["Sums"][3] == 1){
				$MyTimeVal = 'страница';
			} else {
				$MyTimeVal = 'страници';
			}
			if ($MyUserAverageSubjectStatics["Sums"][3] < 1){
				$MyUserAverageSubjectStatics["Sums"][3] = 0;
			}
			$MyTitle = 'Писано - '.$MyUserAverageSubjectStatics["Sums"][3].' '.$MyTimeVal;
			if ($MyUserAverageSubjectStatics["Average"][3] == 1){
				$MyTimeVal = 'страница';
			} else {
				$MyTimeVal = 'страници';
			}
			if ($MyUserAverageSubjectStatics["Average"][3] < 1){
				$MyUserAverageSubjectStatics["Average"][3] = 0;
			}
			$MyTitle .= ', средно по '.$MyUserAverageSubjectStatics["Average"][3].' '.$MyTimeVal .' на задача';
			
			PrintPercentagebarSimple((($MyUserAverageSubjectStatics["Sums"][3]*100)/4.5), $MyTitle, number_format((($MyUserAverageSubjectStatics["Sums"][3]*100)/4.5),0).'%');
			
			
			if ($MyUserAverageSubjectStatics["Average"][2] <= 0){
				$MyUserAverageSubjectStatics["Average"][2] = 0;
			}
			//echo '<p>Мнение за предмета - '.$MyUserAverageSubjectStatics["Average"][2].'%</p>';
			
			PrintPercentagebarSimple($MyUserAverageSubjectStatics["Average"][2], 'Мнение за предмета', number_format($MyUserAverageSubjectStatics["Average"][2], 0).'%');
			
			if ($MyUserAverageSubjectStatics["Average"][4] <= 0){
				$MyUserAverageSubjectStatics["Average"][4] = 0;
			}
			//echo '<p>Научено по предмета - '.$MyUserAverageSubjectStatics["Average"][4].'%</p>';
			
			PrintPercentagebarSimple($MyUserAverageSubjectStatics["Average"][4], 'Научено ', number_format($MyUserAverageSubjectStatics["Average"][4],0).'%');
			
			if ($MyUserAverageSubjectStatics["Average"][5] <= 0){
				$MyUserAverageSubjectStatics["Average"][5] = 0;
			}
			if ($MyUserAverageSubjectStatics["Average"][5] > 0){
				$MyCheating = ((5-$MyUserAverageSubjectStatics["Average"][5])*20);
			} else {
				$MyCheating = 0;
			}

			PrintPercentagebarSimple($MyCheating, 'Преписване ', number_format($MyCheating,0).'%');

			echo '</div>';
		echo '</div>';
		echo '</div>';
		//echo '</div>';
		
		return "YESS";
	}

?>
